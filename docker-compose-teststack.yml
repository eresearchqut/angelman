version: '2'
services:

  datatest:
    extends:
      file: docker-compose-common.yml
      service: datatest

  dbtest:
    extends:
      file: docker-compose-common.yml
      service: db

  dbclinicaltest:
    extends:
      file: docker-compose-common.yml
      service: db

  cachetest:
    extends:
      file: docker-compose-common.yml
      service: cache

  mongotest:
    extends:
      file: docker-compose-common.yml
      service: mongo

  runservertest:
    extends:
      file: docker-compose-common.yml
      service: runserver
    volumes_from:
      - datatest
    command: runserver
    environment:
      - DJANGO_FIXTURES=test
      - ALLOWED_HOSTS=*
      - CACHESERVER=cachetest
      - DBSERVER=dbtest
      - CLINICAL_DBSERVER=dbclinicaltest
      - MONGOSERVER=mongotest
      # https://developers.google.com/recaptcha/docs/faq
      - RECAPTCHA_SITE_KEY=6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI
      - RECAPTCHA_SECRET_KEY=6LeIxAcTAAAAAGG-vFI1TnRWxMZNFuojJ4WifJWe
    depends_on:
      - dbtest
      - dbclinicaltest
      - cachetest
      - mongotest
    ports:
      - "18000:8000"
